<!doctype html>
<!--
  ~ Copyright 2017 Banco Bilbao Vizcaya Argentaria, S.A.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<!-- build:js component.min.js -->
<script src="model.js"></script>
<script src="controller.js"></script>
<!-- endbuild -->
<template>
  <style>
    @import "css/styles.css";

    .applications .component__body {
      display: inline-block;
    }
  </style>

  <div class="applications component__content">
    <div class="component__header">
      <h2 class="title">Markets</h2>
    </div>
    <div class="component__body">
      <div id="container"></div>
    </div>
  </div>
</template>

<script>
  (function (window, document, undefined) {

    // Refers to the "importee", which is components/team-dashboard.html
    var thisDoc = (document._currentScript || document.currentScript).ownerDocument;
    var tmpl = thisDoc.querySelector('template');

    // Creates an object based in the HTML Element prototype
    var MyElementProto = Object.create(Tile);

    MyElementProto.getControllerClass = function () {
      return MarketsController;
    };

    MyElementProto.getTemplate = function () {
      return tmpl;
    };

    MyElementProto.render = function (data) {
      var apps = data && data.apps;

      Utils.raiseEvent(this, {
        status: apps ? 'unknown' : 'server-error'
      });

      var marginTop = 10;

      var container = this.shadowRoot.querySelector('#container');
      container.innerHTML = '';

      for (var index in apps) {
        var appDiv = createAppElement(apps[index])
        container.appendChild(appDiv);
      }
    }

    function createAppElement(app) {
      var div = thisDoc.createElement('div');
      div.setAttribute('class', 'platform-rate');
      var appPlatformTextNode = thisDoc.createTextNode(app.platform);
      var appNameTextNode = thisDoc.createTextNode(" " + app.name);

      var platformIcon = thisDoc.createElement('i');
      platformIcon.setAttribute('aria-hidden', true);

      if (app.platform == "IOS") {
        platformIcon.setAttribute('class', 'fa fa-apple');
        var appPlatformTextNode = platformIcon;
      }
      else if (app.platform == "Android") {
        platformIcon.setAttribute('class', 'fa fa-android');
        var appPlatformTextNode = platformIcon;
      }

      div.appendChild(appPlatformTextNode);
      // TODO: div.appendChild(appNameTextNode);
      var br = thisDoc.createElement('br');
      div.appendChild(br);

      var rate = createStarRatingElement(app.rate);
      rate.setAttribute('class', 'rate');

      div.appendChild(rate);

      return div;
    }

    function createStarRatingElement(rate) {
      var stars = thisDoc.createElement('span');

      for(i = 0; i < 5; i++ ) {
        var star = thisDoc.createElement('i');
        star.setAttribute('aria-hidden', true);
        if(rate - i >= 1 ) {
          star.setAttribute('class', 'fa fa-star');
        } else if (rate - i > 0 ){
          star.setAttribute('class', 'fa fa-star-half-o')
        } else {
          star.setAttribute('class', 'fa fa-star-o')
        }
        stars.appendChild(star);
      }

      return stars;
    }

    // Registers <team-dashboard> in the main document
    window.MyElement = document.registerElement('markets-tile', {
      prototype: MyElementProto
    });
  })(window, document);

</script>
