<!doctype html>
<!--
  ~ Copyright 2017 Banco Bilbao Vizcaya Argentaria, S.A.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<link rel="import" href="./aggregate/component.html" >
<link rel="import" href="./detail/component.html" >
<link rel="import" href="./simple/component.html" >
<template>
  <style>
    @import "css/{skin}.css";
  </style>
  <aggregate-dashboard rv-if="aggregated" rv-config="config" class="page-component"></aggregate-dashboard>
  <div rv-if="simple">
    <simple-dashboard rv-unless="aggregated" rv-config="config" class="page-component"></simple-dashboard>
  </div>
  <div rv-unless="simple">
    <detail-dashboard rv-unless="aggregated" rv-config="config" class="page-component"></detail-dashboard>
  </div>
</template>

<script>
  MGComponent({
    name: 'dashboard-component',
    parent: DashboardComponent,
    lightDOM: true,
    onCreated: function () {
      var detailsService =
          Service.get(Service.types.dashboard, Utils.getDashboardId());
      var model = this.getModel();
      model.simple = this.getAttribute('simple') === 'true';
      return new Promise(function (resolve) {
        detailsService.addListener(function(config) {
          model.details = config && JSON.parse(config);
          model.aggregated = model.details.type === "Aggregate";
          model.details.simple = model.simple || false;
          model.config = JSON.stringify(model.details);
          resolve(model.config);
        });
      });
    }
  });
</script>
